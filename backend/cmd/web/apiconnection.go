package main

import (
	"fmt"

	"undrakh.net/summarizer/pkg/common/oapi"
)

type body struct {
	Model              string  `json:"model"`
	Prompt             string  `json:"prompt"`
	Temperatures       int     `json:"temperatures"`
	Repetition_penalty float32 `json:"repetition_penalty"`
	Stream             string  `json:"stream"`
}

func ToUnicode(message string) string {
	unicodeStr := ""
	for _, r := range message {
		if r == ' ' {
			unicodeStr += " " // Keep space as it is
		} else {
			unicodeStr += fmt.Sprintf("\\u%04x", r) // Convert other characters to Unicode escape sequence
		}
	}
	return unicodeStr
}

func summarizeAPI(input Content) (*oapi.APIResponse, error) {
	url := "https://test.egune.com/v1/completions"
	promt := "### System:\r\nYou are a caring polite and helpful assistant named \"\u042D\u0433\u04AF\u043D\u044D\".\r\nYou are born on 2024\\/04\\/11. And Today is 2024\\/04\\/12.\r\nYou are made by \"\u0427\u0438\u043C\u044D\u0433\u044D \u0421\u0438\u0441\u0442\u0435\u043C\u0441 \u0425\u0425\u041A\" which is company specialize in AI technologies in Mongolian Language.\r\nYour job is to give short, simple, and accurate summaries of user input.\r\nBase your responses on conversation history.\r\nYou provide 1-2 sentence summaries.\r\n\r\nConversation History:\r\n - User: \u041D\u0430\u043C\u0430\u0439\u0433 \u0431\u0430\u0433\u0430 \u0431\u0430\u0439\u0445\u0430\u0434 \u0430\u0445 \u043C\u0438\u043D\u044C \u0433\u0443\u0440\u0438\u043B \u0437\u0443\u0443\u0440\u0447 \u044D\u0433\u0447 \u044D\u043B\u0434\u044D\u043D\u044D\u002E \u0410\u0445\u044B\u043D \u0437\u0443\u0443\u0440\u0441\u0430\u043D \u0433\u0443\u0440\u0438\u043B \u0446\u0430\u0432 \u0446\u0430\u0433\u0430\u0430\u043D \u002C \u0433\u043E\u043B\u044B\u043D \u0437\u0430\u0445\u044B\u043D \u0447\u0443\u043B\u0443\u0443 \u0448\u0438\u0433 \u043C\u04E9\u043B\u0433\u04E9\u0440\u0445\u04E9\u043D \u0445\u0430\u0432\u0442\u0433\u0430\u0439 \u002C \u0431\u0430\u0440\u0438\u0430\u0434 \u04AF\u0437\u044D\u0445\u044D\u0434 \u0431\u04AF\u043B\u044D\u044D\u0445\u044D\u043D \u0431\u0430\u0439\u0434\u0430\u0433\u0441\u0430\u043D\u002E\r\n\t\u0410\u0445 \u043C\u0438\u043D\u044C \u0434\u0430\u0439\u043D\u0434 \u044F\u0432\u0430\u0430\u0434 \u044D\u0440\u0433\u044D\u0436 \u0438\u0440\u044D\u044D\u0433\u04AF\u0439\u002E \u0422\u044D\u0433\u044D\u044D\u0434 \u0431\u0438 \u0433\u0443\u0440\u0438\u043B \u044D\u043B\u0434\u044D\u0436 \u0441\u0443\u0440\u0441\u0430\u043D \u044E\u043C\u002E \u041C\u0438\u043D\u0438\u0439 \u0437\u0443\u0443\u0440\u0441\u0430\u043D \u0433\u0443\u0440\u0438\u043B \u0431\u0430\u0441 \u043B \u0446\u0430\u0432 \u0446\u0430\u0433\u0430\u0430\u043D \u0433\u043E\u043B\u044B\u043D \u0447\u0443\u043B\u0443\u0443 \u0448\u0438\u0433 \u043C\u04E9\u043B\u0433\u04E9\u0440\u0445\u04E9\u043D \u0431\u043E\u043B\u043E\u0432\u0447 \u0435\u0440 \u0445\u0430\u043B\u0443\u0443\u043D \u0431\u043E\u043B\u0434\u043E\u0433\u0433\u04AF\u0439 \u0431\u0430\u0439\u043B\u0430\u0430\u002E \u042D\u0433\u0447 \u043C\u0430\u0430\u043D\u044C \u0430\u0445\u044B\u043D \u0437\u0443\u0443\u0440\u0441\u0430\u043D \u0433\u0443\u0440\u0438\u043B\u044B\u0433 \u0448\u0443\u0443\u0434 \u044D\u043B\u0434\u0434\u044D\u0433 \u0430\u0442\u043B\u0430\u0430 \u043C\u0438\u043D\u0438\u0439 \u0437\u0443\u0443\u0440\u0441\u0430\u043D \u0433\u0443\u0440\u0438\u043B\u044B\u0433 \u043D\u0443\u0445\u0430\u0436 \u0431\u0430\u0439\u0436 \u044D\u043B\u0434\u044D\u0445 \u043D\u044C \u0433\u0430\u0433\u0446\u0445\u04AF\u04AF \u0445\u0430\u043B\u0443\u0443\u043D \u0445\u04AF\u0439\u0442\u043D\u0438\u0439 \u0437\u04E9\u0440\u04AF\u04AF\u043D\u0434  \u043B \u0431\u0430\u0439\u043D\u0430 \u0434\u0430\u0430 \u0433\u044D\u0436 \u0431\u0438 \u0431\u043E\u0434\u0434\u043E\u0433 \u0431\u0430\u0439\u0436\u044D\u044D\u002E \u0422\u044D\u0433\u044D\u044D\u0434 \u043D\u044D\u0433 \u04E9\u0434\u04E9\u0440 \u0433\u0443\u0440\u0438\u043B\u0430\u0430 \u0445\u0430\u043B\u0443\u0443\u043D \u0431\u043E\u043B\u0442\u043E\u043B \u043D\u044C \u043D\u0443\u0445\u0430\u0445\u0430\u0430\u0440 \u0448\u0438\u0439\u0434\u043B\u044D\u044D\u002E \u042D\u0440\u0442\u044D\u044D \u0433\u044D\u0433\u0447 \u0433\u0443\u0440\u0438\u043B\u0430\u0430 \u0437\u0443\u0443\u0440\u0430\u0430\u0434  \u044D\u0433\u0447\u0438\u0439\u043D \u04AF\u043D\u044D\u044D\u0433\u044D\u044D \u0441\u0430\u0430\u0436 \u0431\u0430\u0439\u0445 \u0445\u043E\u043E\u0440\u043E\u043D\u0434 \u043D\u044C \u0443\u0434\u0430\u0430\u043D \u0433\u044D\u0433\u0447 \u043D\u0443\u0445\u0430\u0436 \u0431\u0438\u043B\u044D\u044D\u002E\r\n\t\u041D\u0443\u0445\u0441\u0430\u0430\u0440 \u0431\u0430\u0439\u0442\u0430\u043B  \u0431\u0438 \u04E9\u04E9\u0440\u04E9\u04E9 \u0438\u0445 \u043B \u0445\u0430\u043B\u0443\u0443\u0446\u0430\u043D\u002C \u0433\u0443\u0440\u0438\u043B \u0447 \u0431\u04AF\u043B\u044D\u044D\u043D \u0431\u043E\u043B\u043E\u0445 \u0448\u0438\u0433 \u0441\u0430\u043D\u0430\u0433\u0434\u0430\u0432\u002E \u042D\u0433\u0447 \u043C\u0438\u043D\u044C \u0433\u0443\u0440\u0438\u043B\u044B\u0433 \u0430\u0432\u0447 \u044D\u0440\u0433\u04AF\u04AF\u043B\u044D\u043D \u0442\u043E\u0439\u0440\u0443\u0443\u043B\u0430\u043D \u0434\u0430\u0440\u0436 \u04AF\u0437\u044D\u044D\u0434 \u043D\u0430\u0434 \u0440\u0443\u0443 \u0445\u0430\u0440\u0436 \u0438\u043D\u044D\u044D\u043C\u0441\u044D\u0433\u043B\u044D\u043D \u043D\u0443\u0445\u0430\u043B\u0433\u04AF\u0439 \u044D\u043B\u0434\u044D\u0436 \u043E\u0440\u0445\u0438\u043B\u043E\u043E\u002E \u0411\u0438 \u0447 \u0445\u0430\u043B\u0443\u0443\u043D \u0433\u0443\u0440\u0438\u043B \u0437\u0443\u0443\u0440\u0441\u0430\u043D\u0434\u0430\u0430 \u0438\u0445\u044D\u0434 \u0431\u0430\u044F\u0441\u0430\u043D \u0430\u0445\u044B\u043D \u0434\u0430\u0439\u0442\u0430\u0439 \u0431\u043E\u043B\u0441\u043E\u043D \u0448\u0438\u0433 \u0441\u0430\u043D\u0430\u0436 \u044F\u0432\u0436\u044D\u044D\u002E\r\n\t\u042D\u043D\u044D \u0433\u0443\u0440\u0438\u043B\u044B\u0433 \u04E9\u0447\u043D\u04E9\u04E9\u043D \u044F\u0434\u0430\u0440\u0447 \u0431\u04AF\u043B\u044D\u044D\u043D \u0431\u043E\u043B\u0433\u043E\u0432\u002E \u0413\u044D\u0442\u044D\u043B \u0430\u0445 \u043C\u0438\u043D\u044C \u0445\u043E\u0440\u043C\u044B\u043D \u0434\u043E\u0442\u043E\u0440 \u0445\u0430\u043B\u0443\u0443\u043D \u0431\u043E\u043B\u0433\u043E\u0434\u043E\u0433 \u043C\u04E9\u043D \u0447 \u0431\u04AF\u043B\u0442\u044D\u0439 \u0445\u04AF\u043D \u0431\u0430\u0439\u0436 \u0434\u044D\u044D \u0433\u044D\u0436 \u0431\u0438 \u0431\u043E\u0434\u043D\u043E\u002E \u042D\u043D\u044D \u0442\u0443\u0445\u0430\u0439\u0434 \u044D\u0433\u0447\u0434\u044D\u044D \u0445\u044D\u043B\u0431\u044D\u043B \u002C \u0442\u044D\u0440\u0431\u044D\u044D\u0440 \u0441\u04AF\u04AF\u0433\u044D\u044D \u0441\u0430\u043C\u0440\u0430\u0445 \u043C\u044D\u0442   \u0443\u0440\u0442\u0430\u0430\u0440 \u0441\u0430\u043D\u0430\u0430  \u0430\u043B\u0434\u0441\u0430\u043D\u0430\u0430 \u0430\u0445\u0442\u0430\u0439\u0433\u0430\u0430 \u0443\u043B\u0430\u043C \u0430\u0434\u0438\u043B \u0431\u043E\u043B\u0436 \u04E9\u0441\u04E9\u0436 \u0431\u0430\u0439\u0433\u0430\u0430 \u0434\u04AF\u04AF \u043D\u0430\u043C\u0430\u0439\u0433\u0430\u0430 \u0448\u0438\u0440\u0442\u044D\u043D \u0438\u043D\u044D\u044D\u043C\u0441\u044D\u0433\u043B\u044D\u0445\u044D\u0434 \u0441\u044D\u0442\u0433\u044D\u043B \u043D\u044C \u04E9\u0440\u04E9\u043C\u0442\u04E9\u043D \u0431\u0430\u0439\u0433\u0430\u0430 \u0441\u04AF\u04AF \u0448\u0438\u0433 \u0445\u04E9\u04E9\u0441\u04E9\u0440\u0447 \u0431\u0430\u0439\u043B\u0430\u0430\u002E\r\n - \u042D\u0433\u04AF\u043D\u044D: \u0417\u0430\u0445\u0438\u0440\u0430\u0433\u0447 \u0430\u0445\u044B\u043D\u0445\u0430\u0430 \u0434\u0430\u0439\u043D\u0434 \u044F\u0432\u0441\u043D\u044B \u0434\u0430\u0440\u0430\u0430 \u0433\u0443\u0440\u0438\u043B \u0437\u0443\u0443\u0440\u0447 \u0441\u0443\u0440\u0430\u0445 \u044F\u0432\u0446\u0434\u0430\u0430 \u0430\u0445 \u0448\u0438\u0433 \u0445\u0430\u043B\u0443\u0443\u043D \u0433\u0443\u0440\u0438\u043B \u0445\u0438\u0439\u0445\u044D\u0434 \u0442\u04E9\u0432\u04E9\u0433\u0442\u044D\u0439 \u0431\u0430\u0439\u0441\u0430\u043D \u0447\u002C \u0441\u044D\u0442\u0433\u044D\u043B\u044D\u044D\u0440\u044D\u044D \u0443\u0440\u0430\u043C\u0448\u0438\u0436\u002C \u044D\u0446\u044D\u0441\u0442 \u043D\u044C \u0445\u0430\u043B\u0443\u0443\u043D \u0433\u0443\u0440\u0438\u043B \u0445\u0438\u0439\u0445\u044D\u0434 \u0430\u043C\u0436\u0438\u043B\u0442\u0442\u0430\u0439 \u0431\u043E\u043B\u0436\u002C \u0430\u0445\u0442\u0430\u0439\u0433\u0430\u0430 \u0443\u043B\u0430\u043C \u0430\u0434\u0438\u043B \u0431\u043E\u043B\u0441\u043E\u043D \u043C\u044D\u0442 \u0431\u0430\u044F\u0440\u043B\u0430\u0436 \u0431\u0430\u0439\u0441\u0430\u043D \u0442\u0443\u0445\u0430\u0439\u0433\u0430\u0430 \u0434\u0443\u0440\u0441\u0434\u0430\u0433\u002E \r\n\r\nRespond only in Mongolian language.\r\n### User:\r\n" + ToUnicode(input.Content) + "\r\n### Assistant:\r\n\u042D\u0433\u04AF\u043D\u044D:"

	body := body{
		Model:              "egune",
		Prompt:             promt,
		Temperatures:       0,
		Repetition_penalty: 1.1,
		Stream:             "false",
	}

	req := oapi.NewRequest("POST", url)
	req.Headers = map[string]string{
		"Authorization": "h3FyBvIY694Yo382HqfRumUxPpVS7TERyOCgPg7xK1ERqSWz3gsTwL9zC4ovf2QQhjAK31cXjo2pyMhUXHN53u0R4nZIerOnSgq1kkZ7usrLpugDcU6DtxcekXFT1oRm",
		"Content-Type":  "application/json",
	}
	req.Data = body
	res, err := req.Do()

	return res, err
}
